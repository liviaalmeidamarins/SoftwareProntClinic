<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProntClinic</title>
    <link rel="icon" href="img/logo-png.png" type="image/x-icon">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/style2.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
</head>

<body>

    <nav>
        <ul>
            <li>
                <a href="#" class="aa">
                    <img src="img/logo-png.png" alt="">
                    <span class="nav-item"></span>
                </a>
            </li>

            <li>
                <a href="#" class="aa icon" id="homeIcon">
                    <i class="bi bi-house-door"></i>
                    
                </a>
            </li>
            <li>
                <a href="#" class="aa icon" id="openModalBtn">
                    <i class="bi bi-pencil-square"></i>
                    
                </a>
            </li>
            <li>
                <a href="#" class="aa icon" id="modal3">
                    <i class="bi bi-gear"></i>
                    
                </a>
            </li>

        </ul>
    </nav>


    <div id="ModalCadastro" class="modal">
        <div class="modal-content">
            <span class="close" id="closeModalCadastro">&times;</span>
            <h3 id="titulo-modal-cadastro">Cadastro</h3>
            <br>
            <form id="Cadastro_form">
                <div class="formataçao-modal">
                    <input type="hidden" name="tipo" value="Cadastro">
                    <br>
                    <label for="cpf-cadastro">CPF *</label>
                    <input type="text" id="cpf-cadastro" name="cpf-cadastro" placeholder="Digite o CPF" required readonly>
                    
                    <label for="nome-cadastro">Nome *</label>
                    <input type="text" id="nome" name="nome" placeholder="Digite o nome" required>
                    <span id="mensagemErro" class="text-danger"></span><br>

                    <label for="telefone-cadastro">Telefone</label>
                    <input type="tel" id="telefone" name="telefone" placeholder="(DDD) XXXXX-XXXX">
                    
                    <label for="email-cadastro">E-mail</label>
                    <input type="email" id="email" name="email" placeholder="Digite o e-mail">
                    
                    <label for="convenio-cadastro">Convênio</label>
                    <input type="text" id="convenio" name="convenio" placeholder="Digite o convênio">
                    
                    <label for="data-nascimento-cadastro">Data de nascimento</label>
                    <input type="date" id="dataNascimento" name="dataNascimento">
                    
                    <input type="button" class="btn btn-primary" style="background-color: #D6E88D; border: transparent;" value="Consultar" onclick="Cadastrar()">
                </div>
            </form>
        </div>
    </div>

    <div id="modalInformacoesPaciente" class="modal">
        <div class="modal-content">
            <span class="close" id="closeModalInformacoesPaciente">&times;</span>
            <h3>Informações do Paciente</h3>
            <br>
            <form action="../Controller/controllerSistema.php" method="post">
                <div class="formataçao-modal">
                    <br>
                    <label for="cpf-cadastro">CPF *</label>
                    <input type="text" id="cpf-cadastro" name="cpf-cadastro" placeholder="Digite o CPF" required readonly>
                    
                    <label for="nome">Nome *</label>
                    <input type="text" id="nome" name="nome" placeholder="Digite o nome" required>
                    
                    <label for="telefone">Telefone</label>
                    <input type="tel" id="telefone" name="telefone" placeholder="(DDD) XXXXX-XXXX">
                    
                    <label for="email">E-mail</label>
                    <input type="email" id="email" name="email" placeholder="Digite o e-mail">
                    
                    <label for="convenio">Convênio</label>
                    <input type="text" id="convenio" name="convenio" placeholder="Digite o convênio">
                    
                    <label for="data-nascimento">Data de nascimento</label>
                    <input type="date" id="dataNascimento" name="dataNascimento">
                    
                    <button class="botao-Enviar" style="font-weight: bolder; color: white;">Cadastrar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="conferirCpfModal" class="modal">
        <div class="modal-content">
            <span class="close" id="closeConferirCpfModal">&times;</span>
            <h3 id="titulo-modal-conferir">Conferir CPF</h3>
            <br>
            <form id="CPF_form">
                <div class="formataçao-modal">
                    <input type="hidden" name="tipo" value="CPF_Modal">
                    <br>
                    <label for="cpf-conferir">CPF</label>
                    <input type="text" id="cpf-conferir" name="cpf" placeholder="Digite o CPF" required>
                    <span id="mensagemErro" class="text-danger"></span><br>
                    <input type="button" class="btn btn-primary" style="background-color: #D6E88D; border: transparent;" value="Consultar" onclick="ConsultarCPF()">
                </div>
            </form>
        </div>
    </div>

    <!-- Modal -->
    <div id="minhamodal3" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3 id="titulo-modal3">Configurações</h3>
            <br>
            <form action="" method="post">
                <div class="formataçao-modal">
                    <br>
                    <label for="cpf">CPF/CNPJ</label>
                    <input type="text" id="input-modal3" name="cpf" placeholder="CPF/CNPJ Cadastrado" required>
                    <label for="Nome">Empresa</label>
                    <input type="text" name="email" id="input-modal3" placeholder="Nome da empresa">
                    <label for="email">Email</label>
                    <input type="text" name="email" id="input-modal3" placeholder="Email cadastrado">
                    <label for="telefone">Telefone</label>
                    <input type="number" name="email" id="input-modal3" placeholder="(ddd) xxxxx-xxxx">
                    <button class="botao-Enviar" style="font-weight: bolder; color: white;">Salvar</button>
                </div>

            </form>

        </div>
    </div>

    <main>
        <div class="frase">
            <h3>Bem-vindo, </h3>
        </div>

        <input type="text" placeholder="Name or CPF" class="form-control pesquisa input-icon">


        <div class="bloco">
            <div class="bloquinho">
                <p>Abril</p>
            </div>
            <div class="nome">
                <h6>Lívia Almeida Marins</h6>
                <h6>527.601.488.40</h6>
            </div>
        </div>
    </main>




    <script src="js/bootstrap.min.js"></script>
    <script src="js/app.js"></script>
    <script>

        document.getElementById('openModalBtn').addEventListener('click', function(event) {
            event.preventDefault(); // Evita o comportamento padrão do link
            document.getElementById('conferirCpfModal').style.display = 'block';
        });
    
        // Função para fechar os modais
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
    
        document.getElementById('closeConferirCpfModal').addEventListener('click', function() {
            closeModal('conferirCpfModal');
        });
    
        document.getElementById('closeModalCadastro').addEventListener('click', function() {
            closeModal('ModalCadastro');
        });
    
        document.getElementById('closeModalInformacoesPaciente').addEventListener('click', function() {
            closeModal('modalInformacoesPaciente');
        });
    
        window.addEventListener('click', function(event) {
            if (event.target.className === 'modal') {
                event.target.style.display = 'none';
            }
        });
    
        function ConsultarCPF() 
        {
            console.log("Enviando formulário...");
            $.ajax(
            {
                type: "POST",
                url: "../Controller/controllerSistema.php",
                data: $("#CPF_form").serialize(),
                success: function(response) 
                {
                    console.log("Resposta recebida:", response); // Debug: log the response to the console
                    var resposta = JSON.parse(response);
                    var cpf = $("#cpf-conferir").val().replace(/\D/g, ''); // Remove caracteres não numéricos
                    
                    if (resposta.status === 'CPF_nao_encontrado') 
                    {
                        closeModal('conferirCpfModal');
                        document.getElementById('cpf-cadastro').value = cpf;
                        document.getElementById('ModalCadastro').style.display = 'block';
                    }
                    else if (resposta.status === 'CPF_existente') 
                    {
                        closeModal('conferirCpfModal');
                        document.getElementById('cpf-cadastro').value = cpf;
                        document.getElementById('modalInformacoesPaciente').style.display = 'block';
                    } 
                    else if (resposta.status === 'CPF_invalido') 
                    {
                        $("#mensagemErro").text("O CPF deve conter 11 dígitos.");
                    }
                },
                error: function(xhr, status, error) 
                {
                    console.error('AJAX Error:', status, error);
                }
            });
        }
    
        function Cadastrar() 
        {
            console.log("Enviando formulário...");
            $.ajax(
            {
                type: "POST",
                url: "../Controller/controllerSistema.php",
                data: $("#Cadastro_form").serialize(),
                success: function(response) 
                {
                    console.log("Resposta recebida:", response); // Debug: log the response to the console
                    var resposta = JSON.parse(response);
                    if (resposta.status === 'Cadastro_feito') 
                    {
                        closeModal('ModalCadastro');                
                    } 
                    else if (resposta.status === 'Nome_vazio') 
                    {
                        $("#mensagemErro").text("O nome é obrigatorio");
                    }
                    else if (resposta.status === 'Nome_grande') 
                    {
                    $("#mensagemErro").text("O nome deve ter no maximo 255 letras");
                    }
                },
                error: function(xhr, status, error) 
                {
                    console.error('AJAX Error:', status, error);
                }
            });
        }
        </script>
</body>

</html>